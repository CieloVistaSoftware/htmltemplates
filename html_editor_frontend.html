<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML Editor - Development</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            height: 100vh;
            display: grid;
            grid-template-areas: 
                "header header header"
                "html-items canvas canvas"
                "footer footer footer";
            grid-template-rows: 10% 80% 10%;
            grid-template-columns: 25% 1fr 1fr;
        }

        /* Header Styles */
        #header-section {
            grid-area: header;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        #page-title {
            font-size: 1.5rem;
            font-weight: 600;
        }

        #toolbar {
            display: flex;
            gap: 10px;
        }

        #toolbar button {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        #toolbar button:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-1px);
        }

        #toolbar button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Main Container */
        #main-container {
            display: contents;
        }

        /* HTML Items Panel */
        #html-items-panel {
            grid-area: html-items;
            background: white;
            border-right: 1px solid #e0e0e0;
            padding: 20px;
            overflow-y: auto;
        }

        #panel-title {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        #search-container {
            margin-bottom: 20px;
        }

        #element-search {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .section {
            margin-bottom: 20px;
        }

        .section.collapsible h4 {
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f8f9ff;
            border-radius: 6px;
            margin-bottom: 10px;
            user-select: none;
        }

        .toggle-icon {
            transition: transform 0.3s ease;
        }

        .section.collapsed .toggle-icon {
            transform: rotate(-90deg);
        }

        .section.collapsed ul {
            display: none;
        }

        .section ul {
            list-style: none;
            padding-left: 10px;
        }

        .section li {
            padding: 12px;
            margin: 5px 0;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            cursor: grab;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section li:hover {
            background: #f0f7ff;
            border-color: #4CAF50;
            transform: translateX(5px);
        }

        .section li:active {
            cursor: grabbing;
        }

        .section li::before {
            content: '⋮⋮';
            color: #ccc;
            font-weight: bold;
        }

        /* Canvas Area */
        #canvas-area {
            grid-area: canvas;
            background: white;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        #canvas-toolbar {
            background: #f8f9fa;
            padding: 10px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        #canvas-toolbar button, #canvas-toolbar select {
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            font-size: 14px;
        }

        #canvas-toolbar button:hover {
            background: #e9ecef;
        }

        #canvas-toolbar button.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        #editor-canvas {
            flex: 1;
            background: white;
            margin: 20px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            position: relative;
            overflow: auto;
            min-height: 400px;
        }

        .canvas-drop-active {
            border-color: #4CAF50 !important;
            background: #f0fff0 !important;
        }

        #canvas-welcome {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #999;
            pointer-events: none;
        }

        #canvas-welcome.hidden {
            display: none;
        }

        /* Dropped Elements */
        .dropped-element {
            position: absolute;
            min-width: 100px;
            min-height: 30px;
            border: 2px solid transparent;
            cursor: move;
            padding: 8px;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-radius: 4px;
        }

        .dropped-element:hover {
            border-color: #007bff;
        }

        .dropped-element.selected {
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }

        .element-handles {
            display: none;
        }

        .dropped-element.selected .element-handles {
            display: block;
        }

        .resize-handle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #007bff;
            border: 1px solid white;
            border-radius: 50%;
        }

        .resize-handle.nw { top: -4px; left: -4px; cursor: nw-resize; }
        .resize-handle.ne { top: -4px; right: -4px; cursor: ne-resize; }
        .resize-handle.sw { bottom: -4px; left: -4px; cursor: sw-resize; }
        .resize-handle.se { bottom: -4px; right: -4px; cursor: se-resize; }

        /* Property Panel */
        #property-panel {
            position: absolute;
            right: 20px;
            top: 80px;
            width: 300px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 1000;
        }

        #property-panel.hidden {
            display: none;
        }

        #css-editor {
            margin-top: 15px;
        }

        #css-input {
            width: 100%;
            height: 150px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            resize: vertical;
        }

        #apply-css {
            margin-top: 10px;
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Footer */
        #footer-section {
            grid-area: footer;
            background: #343a40;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        #status-info {
            display: flex;
            gap: 20px;
            font-size: 14px;
        }

        #status-info span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .connected::before {
            content: '●';
            color: #28a745;
        }

        .disconnected::before {
            content: '●';
            color: #dc3545;
        }

        #status-container {
            position: fixed;
            bottom: 60px;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #ddd;
            max-height: 20rem;
            overflow-y: auto;
            z-index: 999;
            transition: all 0.3s ease;
        }

        #status-container.hidden {
            transform: translateY(100%);
        }

        #error-controls {
            padding: 10px 20px;
            background: #f8f9fa;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        #status-message-list {
            list-style: none;
            max-height: 15rem;
            overflow-y: auto;
        }

        .error-message {
            padding: 10px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .error-message.INFO { border-left: 4px solid #2196F3; }
        .error-message.WARNING { border-left: 4px solid #FF9800; }
        .error-message.ERROR { border-left: 4px solid #F44336; }
        .error-message.CRITICAL { border-left: 4px solid #9C27B0; }

        /* Context Menu */
        .context-menu {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 1001;
            min-width: 150px;
        }

        .context-menu button {
            display: block;
            width: 100%;
            padding: 10px 15px;
            border: none;
            background: none;
            text-align: left;
            cursor: pointer;
            font-size: 14px;
        }

        .context-menu button:hover {
            background: #f0f7ff;
        }

        /* Responsive Breakpoints */
        .responsive-frame {
            margin: 20px auto;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: white;
            transition: all 0.3s ease;
        }

        .responsive-frame.mobile {
            width: 375px;
            height: 667px;
        }

        .responsive-frame.tablet {
            width: 768px;
            height: 1024px;
        }

        .responsive-frame.desktop {
            width: 100%;
            height: 100%;
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        .dragging { opacity: 0.7; }
        .drag-preview { 
            position: fixed;
            pointer-events: none;
            z-index: 1000;
            opacity: 0.8;
            transform: rotate(5deg);
        }

        /* Animation */
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
    </style>
</head>
<body>
    <!-- Header Section -->
    <div id="header-section">
        <h1 id="page-title">HTML Editor - Development</h1>
        <div id="toolbar">
            <button id="new-btn" data-tooltip="New project">New</button>
            <button id="save-btn" data-tooltip="Save current layout">Save</button>
            <button id="load-btn" data-tooltip="Load project">Load</button>
            <button id="undo-btn" data-tooltip="Undo last action" disabled>Undo</button>
            <button id="redo-btn" data-tooltip="Redo last action" disabled>Redo</button>
            <button id="export-btn" data-tooltip="Export HTML">Export</button>
        </div>
    </div>

    <!-- Main Container -->
    <div id="main-container">
        <!-- HTML Items Panel -->
        <div id="html-items-panel">
            <h3 id="panel-title">HTML Elements</h3>
            <div id="search-container">
                <input type="search" id="element-search" placeholder="Search elements..." />
            </div>
            
            <div id="layout-section" class="section collapsible">
                <h4>Layout <span class="toggle-icon">▼</span></h4>
                <ul>
                    <li id="container-item" data-element-type="container" data-category="layout" draggable="true">Container</li>
                    <li id="row-item" data-element-type="row" data-category="layout" draggable="true">Row</li>
                    <li id="column-item" data-element-type="column" data-category="layout" draggable="true">Column</li>
                    <li id="grid-item" data-element-type="grid" data-category="layout" draggable="true">Grid</li>
                    <li id="flexbox-item" data-element-type="flexbox" data-category="layout" draggable="true">Flexbox</li>
                </ul>
            </div>
            
            <div id="html-tags-section" class="section collapsible">
                <h4>HTML Tags <span class="toggle-icon">▼</span></h4>
                <ul>
                    <li id="header-item" data-element-type="header" data-category="content" draggable="true">Header</li>
                    <li id="paragraph-item" data-element-type="paragraph" data-category="content" draggable="true">Paragraph</li>
                    <li id="image-item" data-element-type="image" data-category="media" draggable="true">Image</li>
                    <li id="button-item" data-element-type="button" data-category="interactive" draggable="true">Button</li>
                    <li id="input-item" data-element-type="input" data-category="interactive" draggable="true">Input</li>
                    <li id="form-item" data-element-type="form" data-category="interactive" draggable="true">Form</li>
                    <li id="table-item" data-element-type="table" data-category="content" draggable="true">Table</li>
                    <li id="list-item" data-element-type="list" data-category="content" draggable="true">List</li>
                </ul>
            </div>
        </div>

        <!-- Canvas Area -->
        <div id="canvas-area">
            <div id="canvas-toolbar">
                <button id="preview-mode">Preview</button>
                <button id="code-view">Code View</button>
                <button id="responsive-test">Responsive</button>
                <select id="zoom-level">
                    <option value="50">50%</option>
                    <option value="75">75%</option>
                    <option value="100" selected>100%</option>
                    <option value="125">125%</option>
                    <option value="150">150%</option>
                </select>
            </div>
            
            <div id="editor-canvas">
                <div id="canvas-welcome">
                    <h2>Welcome to HTML Editor</h2>
                    <p>Drag and drop elements here to start building!</p>
                </div>
            </div>
            
            <div id="property-panel" class="hidden">
                <h4>Element Properties</h4>
                <div id="property-form">
                    <div id="element-info">
                        <p><strong>Type:</strong> <span id="selected-type">-</span></p>
                        <p><strong>ID:</strong> <input type="text" id="element-id" placeholder="Enter ID..." /></p>
                        <p><strong>Class:</strong> <input type="text" id="element-class" placeholder="Enter classes..." /></p>
                    </div>
                    <div id="css-editor">
                        <h5>CSS Styles</h5>
                        <textarea id="css-input" placeholder="Enter CSS rules...&#10;color: blue;&#10;font-size: 16px;&#10;margin: 10px;"></textarea>
                        <button id="apply-css">Apply Styles</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer Section -->
    <div id="footer-section">
        <p id="copyright">HTML Editor © 2025 - Development Mode</p>
        <div id="status-info">
            <span id="element-count">Elements: 0</span>
            <span id="last-saved">Last saved: Never</span>
            <span id="connection-status" class="connected">Connected</span>
            <span id="selected-element">Selected: None</span>
            <span id="file-status">File: Untitled</span>
        </div>
    </div>

    <!-- Status Container -->
    <div id="status-container" class="hidden">
        <h4 style="padding: 10px 20px; margin: 0; background: #f8f9fa; border-bottom: 1px solid #ddd;">Status Messages</h4>
        <div id="error-controls">
            <input type="search" id="error-search" placeholder="Filter errors..." />
            <select id="severity-filter">
                <option value="all">All</option>
                <option value="INFO">Info</option>
                <option value="WARNING">Warnings</option>
                <option value="ERROR">Errors</option>
                <option value="CRITICAL">Critical</option>
            </select>
            <button id="clear-errors">Clear All</button>
        </div>
        <ul id="status-message-list"></ul>
    </div>

    <script>
        // Global State Management
        class EditorState {
            constructor() {
                this.elements = [];
                this.selectedElement = null;
                this.history = [];
                this.historyIndex = -1;
                this.elementCounter = 0;
                this.isPreviewMode = false;
                this.currentProject = 'Untitled';
            }

            addElement(element) {
                this.elements.push(element);
                this.elementCounter++;
                this.updateStatus();
                this.saveState();
            }

            removeElement(elementId) {
                this.elements = this.elements.filter(el => el.id !== elementId);
                if (this.selectedElement && this.selectedElement.id === elementId) {
                    this.selectedElement = null;
                }
                this.updateStatus();
                this.saveState();
            }

            selectElement(element) {
                // Deselect previous element
                if (this.selectedElement) {
                    this.selectedElement.element.classList.remove('selected');
                }
                
                this.selectedElement = element;
                element.element.classList.add('selected');
                this.updateStatus();
                this.showPropertyPanel(element);
            }

            deselectAll() {
                if (this.selectedElement) {
                    this.selectedElement.element.classList.remove('selected');
                    this.selectedElement = null;
                }
                this.updateStatus();
                this.hidePropertyPanel();
            }

            updateStatus() {
                document.getElementById('element-count').textContent = `Elements: ${this.elements.length}`;
                document.getElementById('selected-element').textContent = 
                    this.selectedElement ? `Selected: ${this.selectedElement.type}` : 'Selected: None';
            }

            saveState() {
                const state = {
                    elements: this.elements.map(el => ({
                        id: el.id,
                        type: el.type,
                        content: el.element.innerHTML,
                        styles: el.element.style.cssText,
                        position: {
                            x: parseInt(el.element.style.left) || 0,
                            y: parseInt(el.element.style.top) || 0
                        },
                        size: {
                            width: parseInt(el.element.style.width) || 100,
                            height: parseInt(el.element.style.height) || 30
                        }
                    }))
                };
                
                // Add to history
                this.historyIndex++;
                this.history = this.history.slice(0, this.historyIndex);
                this.history.push(JSON.parse(JSON.stringify(state)));
                
                // Limit history size
                if (this.history.length > 50) {
                    this.history.shift();
                    this.historyIndex--;
                }
                
                this.updateUndoRedoButtons();
                sessionStorage.setItem('editorState', JSON.stringify(state));
            }

            undo() {
                if (this.historyIndex > 0) {
                    this.historyIndex--;
                    this.loadState(this.history[this.historyIndex]);
                }
            }

            redo() {
                if (this.historyIndex < this.history.length - 1) {
                    this.historyIndex++;
                    this.loadState(this.history[this.historyIndex]);
                }
            }

            updateUndoRedoButtons() {
                document.getElementById('undo-btn').disabled = this.historyIndex <= 0;
                document.getElementById('redo-btn').disabled = this.historyIndex >= this.history.length - 1;
            }

            loadState(state) {
                // Clear canvas
                const canvas = document.getElementById('editor-canvas');
                this.elements.forEach(el => {
                    if (el.element.parentNode === canvas) {
                        canvas.removeChild(el.element);
                    }
                });
                
                this.elements = [];
                this.selectedElement = null;
                
                // Recreate elements
                state.elements.forEach(elementData => {
                    const element = this.createElement(elementData.type, elementData.position.x, elementData.position.y);
                    element.element.innerHTML = elementData.content;
                    element.element.style.cssText = elementData.styles;
                    element.element.style.width = elementData.size.width + 'px';
                    element.element.style.height = elementData.size.height + 'px';
                });
                
                this.updateStatus();
                this.updateUndoRedoButtons();
            }

            showPropertyPanel(element) {
                const panel = document.getElementById('property-panel');
                const typeSpan = document.getElementById('selected-type');
                const idInput = document.getElementById('element-id');
                const classInput = document.getElementById('element-class');
                const cssInput = document.getElementById('css-input');
                
                typeSpan.textContent = element.type;
                idInput.value = element.element.id || '';
                classInput.value = element.element.className || '';
                cssInput.value = element.element.style.cssText || '';
                
                panel.classList.remove('hidden');
            }

            hidePropertyPanel() {
                document.getElementById('property-panel').classList.add('hidden');
            }

            createElement(type, x, y) {
                const elementData = this.getElementTemplate(type);
                const element = document.createElement('div');
                element.className = 'dropped-element';
                element.innerHTML = elementData.content + `
                    <div class="element-handles">
                        <div class="resize-handle nw"></div>
                        <div class="resize-handle ne"></div>
                        <div class="resize-handle sw"></div>
                        <div class="resize-handle se"></div>
                    </div>
                `;
                
                element.style.left = x + 'px';
                element.style.top = y + 'px';
                element.style.width = elementData.width + 'px';
                element.style.height = elementData.height + 'px';
                
                const elementObj = {
                    id: 'element-' + Date.now(),
                    type: type,
                    element: element
                };
                
                element.id = elementObj.id;
                
                // Add event listeners
                this.addElementEventListeners(elementObj);
                
                // Add to canvas
                document.getElementById('editor-canvas').appendChild(element);
                this.addElement(elementObj);
                
                return elementObj;
            }

            getElementTemplate(type) {
                const templates = {
                    container: { content: '<div style="border: 1px dashed #ccc; padding: 20px;">Container</div>', width: 200, height: 100 },
                    row: { content: '<div style="display: flex; border: 1px dashed #ccc; padding: 10px;">Row</div>', width: 300, height: 60 },
                    column: { content: '<div style="border: 1px dashed #ccc; padding: 10px;">Column</div>', width: 100, height: 200 },
                    grid: { content: '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; border: 1px dashed #ccc; padding: 10px;"><div>Item 1</div><div>Item 2</div></div>', width: 200, height: 120 },
                    flexbox: { content: '<div style="display: flex; justify-content: space-between; border: 1px dashed #ccc; padding: 10px;"><div>Flex 1</div><div>Flex 2</div></div>', width: 250, height: 80 },
                    header: { content: '<h2 contenteditable="true">Header Text</h2>', width: 200, height: 50 },
                    paragraph: { content: '<p contenteditable="true">This is a paragraph. Click to edit.</p>', width: 250, height: 60 },
                    image: { content: '<img src="https://via.placeholder.com/150x100" alt="Placeholder" style="max-width: 100%; height: auto;">', width: 150, height: 100 },
                    button: { content: '<button style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Click Me</button>', width: 120, height: 40 },
                    input: { content: '<input type="text" placeholder="Enter text..." style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 100%;">', width: 200, height: 35 },
                    form: { content: '<form style="border: 1px solid #ddd; padding: 15px; border-radius: 4px;"><label>Name:</label><br><input type="text" style="width: 100%; padding: 5px; margin: 5px 0;"><br><button type="submit">Submit</button></form>', width: 250, height: 120 },
                    table: { content: '<table style="border-collapse: collapse; width: 100%;"><tr><th style="border: 1px solid #ddd; padding: 8px;">Header 1</th><th style="border: 1px solid #ddd; padding: 8px;">Header 2</th></tr><tr><td style="border: 1px solid #ddd; padding: 8px;">Cell 1</td><td style="border: 1px solid #ddd; padding: 8px;">Cell 2</td></tr></table>', width: 250, height: 80 },
                    list: { content: '<ul style="padding-left: 20px;"><li>Item 1</li><li>Item 2</li><li>Item 3</li></ul>', width: 150, height: 80 }
                };
                
                return templates[type] || templates.container;
            }

            addElementEventListeners(elementObj) {
                const element = elementObj.element;
                
                // Click to select
                element.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.selectElement(elementObj);
                });
                
                // Double click to edit
                element.addEventListener('dblclick', (e) => {
                    e.stopPropagation();
                    const editableElement = element.querySelector('[contenteditable]');
                    if (editableElement) {
                        editableElement.focus();
                    }
                });
                
                // Right click context menu
                element.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    this.showContextMenu(e.clientX, e.clientY, elementObj);
                });
                
                // Make draggable
                this.makeDraggable(elementObj);
                this.makeResizable(elementObj);
            }

            makeDraggable(elementObj) {
                const element = elementObj.element;
                let isDragging = false;
                let startX, startY, startLeft, startTop;
                
                element.addEventListener('mousedown', (e) => {
                    if (e.target.classList.contains('resize-handle')) return;
                    
                    isDragging = true;
                    startX = e.clientX;
                    startY = e.clientY;
                    startLeft = parseInt(element.style.left) || 0;
                    startTop = parseInt(element.style.top) || 0;
                    
                    element.style.cursor = 'move';
                    element.classList.add('dragging');
                    
                    e.preventDefault();
                });
                
                document.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;
                    
                    const deltaX = e.clientX - startX;
                    const deltaY = e.clientY - startY;
                    
                    element.style.left = (startLeft + deltaX) + 'px';
                    element.style.top = (startTop + deltaY) + 'px';
                });
                
                document.addEventListener('mouseup', () => {
                    if (isDragging) {
                        isDragging = false;
                        element.style.cursor = 'move';
                        element.classList.remove('dragging');
                        this.saveState();
                    }
                });
            }

            makeResizable(elementObj) {
                const element = elementObj.element;
                const handles = element.querySelectorAll('.resize-handle');
                
                handles.forEach(handle => {
                    let isResizing = false;
                    let startX, startY, startWidth, startHeight, startLeft, startTop;
                    
                    handle.addEventListener('mousedown', (e) => {
                        isResizing = true;
                        startX = e.clientX;
                        startY = e.clientY;
                        startWidth = parseInt(window.getComputedStyle(element).width);
                        startHeight = parseInt(window.getComputedStyle(element).height);
                        startLeft = parseInt(element.style.left) || 0;
                        startTop = parseInt(element.style.top) || 0;
                        
                        e.stopPropagation();
                        e.preventDefault();
                    });
                    
                    document.addEventListener('mousemove', (e) => {
                        if (!isResizing) return;
                        
                        const deltaX = e.clientX - startX;
                        const deltaY = e.clientY - startY;
                        
                        if (handle.classList.contains('se')) {
                            element.style.width = (startWidth + deltaX) + 'px';
                            element.style.height = (startHeight + deltaY) + 'px';
                        } else if (handle.classList.contains('sw')) {
                            element.style.width = (startWidth - deltaX) + 'px';
                            element.style.height = (startHeight + deltaY) + 'px';
                            element.style.left = (startLeft + deltaX) + 'px';
                        } else if (handle.classList.contains('ne')) {
                            element.style.width = (startWidth + deltaX) + 'px';
                            element.style.height = (startHeight - deltaY) + 'px';
                            element.style.top = (startTop + deltaY) + 'px';
                        } else if (handle.classList.contains('nw')) {
                            element.style.width = (startWidth - deltaX) + 'px';
                            element.style.height = (startHeight - deltaY) + 'px';
                            element.style.left = (startLeft + deltaX) + 'px';
                            element.style.top = (startTop + deltaY) + 'px';
                        }
                    });
                    
                    document.addEventListener('mouseup', () => {
                        if (isResizing) {
                            isResizing = false;
                            this.saveState();
                        }
                    });
                });
            }

            showContextMenu(x, y, elementObj) {
                // Remove existing context menu
                const existingMenu = document.querySelector('.context-menu');
                if (existingMenu) {
                    existingMenu.remove();
                }
                
                const menu = document.createElement('div');
                menu.className = 'context-menu';
                menu.style.left = x + 'px';
                menu.style.top = y + 'px';
                
                const menuItems = [
                    { label: 'Edit', action: () => this.editElement(elementObj) },
                    { label: 'Duplicate', action: () => this.duplicateElement(elementObj) },
                    { label: 'Delete', action: () => this.deleteElement(elementObj) },
                    { label: 'Move Up', action: () => this.moveElement(elementObj, 'up') },
                    { label: 'Move Down', action: () => this.moveElement(elementObj, 'down') },
                    { label: 'CSS Editor', action: () => this.openCSSEditor(elementObj) }
                ];
                
                menuItems.forEach(item => {
                    const button = document.createElement('button');
                    button.textContent = item.label;
                    button.addEventListener('click', () => {
                        item.action();
                        menu.remove();
                    });
                    menu.appendChild(button);
                });
                
                document.body.appendChild(menu);
                
                // Remove menu when clicking elsewhere
                setTimeout(() => {
                    document.addEventListener('click', function removeMenu() {
                        menu.remove();
                        document.removeEventListener('click', removeMenu);
                    });
                }, 100);
            }

            editElement(elementObj) {
                this.selectElement(elementObj);
                const editableElement = elementObj.element.querySelector('[contenteditable]');
                if (editableElement) {
                    editableElement.focus();
                    
                    // Select all text
                    const range = document.createRange();
                    range.selectNodeContents(editableElement);
                    const selection = window.getSelection();
                    selection.removeAllRanges();
                    selection.addRange(range);
                }
            }

            duplicateElement(elementObj) {
                const newElement = this.createElement(elementObj.type, 
                    parseInt(elementObj.element.style.left) + 20, 
                    parseInt(elementObj.element.style.top) + 20
                );
                newElement.element.innerHTML = elementObj.element.innerHTML;
                newElement.element.style.cssText = elementObj.element.style.cssText;
                newElement.element.style.left = (parseInt(elementObj.element.style.left) + 20) + 'px';
                newElement.element.style.top = (parseInt(elementObj.element.style.top) + 20) + 'px';
            }

            deleteElement(elementObj) {
                if (confirm('Are you sure you want to delete this element?')) {
                    elementObj.element.remove();
                    this.removeElement(elementObj.id);
                }
            }

            moveElement(elementObj, direction) {
                const currentTop = parseInt(elementObj.element.style.top) || 0;
                const offset = direction === 'up' ? -10 : 10;
                elementObj.element.style.top = (currentTop + offset) + 'px';
                this.saveState();
            }

            openCSSEditor(elementObj) {
                this.selectElement(elementObj);
            }
        }

        // Initialize Editor
        const editorState = new EditorState();

        // Error Handling System
        class ErrorHandler {
            constructor() {
                this.errors = [];
                this.maxErrors = 50;
            }

            logError(severity, message, details = {}) {
                const error = {
                    id: 'error-' + Date.now(),
                    timestamp: new Date(),
                    severity,
                    message,
                    details,
                    source: details.source || 'system'
                };
                
                this.errors.unshift(error);
                
                if (this.errors.length > this.maxErrors) {
                    this.errors = this.errors.slice(0, this.maxErrors);
                }
                
                this.displayError(error);
                this.showStatusContainer();
            }

            displayError(error) {
                const messageList = document.getElementById('status-message-list');
                const errorElement = document.createElement('li');
                errorElement.className = `error-message ${error.severity}`;
                errorElement.innerHTML = `
                    <div>
                        <strong>${error.severity}:</strong> ${error.message}
                        <br><small>${error.timestamp.toLocaleTimeString()}</small>
                    </div>
                    <button onclick="this.parentElement.remove()">×</button>
                `;
                
                messageList.insertBefore(errorElement, messageList.firstChild);
            }

            showStatusContainer() {
                document.getElementById('status-container').classList.remove('hidden');
            }

            clearAllErrors() {
                this.errors = [];
                document.getElementById('status-message-list').innerHTML = '';
                document.getElementById('status-container').classList.add('hidden');
            }
        }

        const errorHandler = new ErrorHandler();

        // Drag and Drop Implementation
        class DragDropManager {
            constructor() {
                this.dragPreview = null;
                this.isDragging = false;
                this.initializeDragDrop();
            }

            initializeDragDrop() {
                // Make elements draggable
                const draggableItems = document.querySelectorAll('[draggable="true"]');
                draggableItems.forEach(item => {
                    item.addEventListener('dragstart', this.handleDragStart.bind(this));
                    item.addEventListener('dragend', this.handleDragEnd.bind(this));
                });

                // Setup drop zone
                const canvas = document.getElementById('editor-canvas');
                canvas.addEventListener('dragover', this.handleDragOver.bind(this));
                canvas.addEventListener('drop', this.handleDrop.bind(this));
                canvas.addEventListener('dragenter', this.handleDragEnter.bind(this));
                canvas.addEventListener('dragleave', this.handleDragLeave.bind(this));
            }

            handleDragStart(e) {
                this.isDragging = true;
                const elementType = e.target.dataset.elementType;
                e.dataTransfer.setData('text/plain', elementType);
                e.dataTransfer.effectAllowed = 'copy';
                
                // Create drag preview
                this.createDragPreview(e.target);
                
                // Hide welcome message
                document.getElementById('canvas-welcome').classList.add('hidden');
            }

            handleDragEnd(e) {
                this.isDragging = false;
                this.removeDragPreview();
                
                // Show welcome message if no elements
                if (editorState.elements.length === 0) {
                    document.getElementById('canvas-welcome').classList.remove('hidden');
                }
            }

            createDragPreview(element) {
                this.dragPreview = element.cloneNode(true);
                this.dragPreview.classList.add('drag-preview');
                document.body.appendChild(this.dragPreview);
                
                document.addEventListener('mousemove', this.updateDragPreview.bind(this));
            }

            updateDragPreview(e) {
                if (this.dragPreview) {
                    this.dragPreview.style.left = (e.clientX + 10) + 'px';
                    this.dragPreview.style.top = (e.clientY + 10) + 'px';
                }
            }

            removeDragPreview() {
                if (this.dragPreview) {
                    this.dragPreview.remove();
                    this.dragPreview = null;
                    document.removeEventListener('mousemove', this.updateDragPreview.bind(this));
                }
            }

            handleDragOver(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'copy';
            }

            handleDragEnter(e) {
                e.preventDefault();
                document.getElementById('editor-canvas').classList.add('canvas-drop-active');
            }

            handleDragLeave(e) {
                if (!e.currentTarget.contains(e.relatedTarget)) {
                    document.getElementById('editor-canvas').classList.remove('canvas-drop-active');
                }
            }

            handleDrop(e) {
                e.preventDefault();
                document.getElementById('editor-canvas').classList.remove('canvas-drop-active');
                
                const elementType = e.dataTransfer.getData('text/plain');
                if (elementType) {
                    const canvasRect = document.getElementById('editor-canvas').getBoundingClientRect();
                    const x = e.clientX - canvasRect.left;
                    const y = e.clientY - canvasRect.top;
                    
                    const newElement = editorState.createElement(elementType, x, y);
                    editorState.selectElement(newElement);
                    
                    errorHandler.logError('INFO', `Added ${elementType} element to canvas`, { source: 'drag-drop' });
                }
            }
        }

        // Initialize Drag & Drop
        const dragDropManager = new DragDropManager();

        // Search Functionality
        class SearchManager {
            constructor() {
                this.setupSearch();
            }

            setupSearch() {
                const searchInput = document.getElementById('element-search');
                searchInput.addEventListener('input', this.handleSearch.bind(this));
            }

            handleSearch(e) {
                const query = e.target.value.toLowerCase();
                const elements = document.querySelectorAll('#html-items-panel li[data-element-type]');
                
                elements.forEach(element => {
                    const elementType = element.dataset.elementType.toLowerCase();
                    const category = element.dataset.category.toLowerCase();
                    const text = element.textContent.toLowerCase();
                    
                    const matches = elementType.includes(query) || 
                                  category.includes(query) || 
                                  text.includes(query);
                    
                    element.style.display = matches ? 'flex' : 'none';
                });

                // Hide sections with no visible elements
                const sections = document.querySelectorAll('.section');
                sections.forEach(section => {
                    const visibleElements = section.querySelectorAll('li[style*="flex"], li:not([style*="none"])');
                    section.style.display = visibleElements.length > 0 ? 'block' : 'none';
                });
            }
        }

        // Initialize Search
        const searchManager = new SearchManager();

        // Toolbar Event Handlers
        document.getElementById('new-btn').addEventListener('click', () => {
            if (confirm('Create new project? Unsaved changes will be lost.')) {
                location.reload();
            }
        });

        document.getElementById('save-btn').addEventListener('click', () => {
            const projectData = {
                name: editorState.currentProject,
                version: '1.0.0',
                elements: editorState.elements.map(el => ({
                    id: el.id,
                    type: el.type,
                    content: el.element.innerHTML,
                    styles: el.element.style.cssText,
                    position: {
                        x: parseInt(el.element.style.left) || 0,
                        y: parseInt(el.element.style.top) || 0
                    },
                    size: {
                        width: parseInt(el.element.style.width) || 100,
                        height: parseInt(el.element.style.height) || 30
                    }
                })),
                timestamp: new Date().toISOString()
            };
            
            // Save to localStorage (simulating backend save)
            localStorage.setItem('htmlEditor_' + editorState.currentProject, JSON.stringify(projectData));
            document.getElementById('last-saved').textContent = 'Last saved: ' + new Date().toLocaleTimeString();
            errorHandler.logError('INFO', 'Project saved successfully', { source: 'save' });
        });

        document.getElementById('load-btn').addEventListener('click', () => {
            const projectName = prompt('Enter project name to load:');
            if (projectName) {
                const savedData = localStorage.getItem('htmlEditor_' + projectName);
                if (savedData) {
                    const projectData = JSON.parse(savedData);
                    editorState.loadState({ elements: projectData.elements });
                    editorState.currentProject = projectName;
                    document.getElementById('file-status').textContent = 'File: ' + projectName;
                    errorHandler.logError('INFO', 'Project loaded successfully', { source: 'load' });
                } else {
                    errorHandler.logError('ERROR', 'Project not found', { source: 'load' });
                }
            }
        });

        document.getElementById('undo-btn').addEventListener('click', () => {
            editorState.undo();
        });

        document.getElementById('redo-btn').addEventListener('click', () => {
            editorState.redo();
        });

        document.getElementById('export-btn').addEventListener('click', () => {
            const canvas = document.getElementById('editor-canvas');
            const elements = canvas.querySelectorAll('.dropped-element');
            
            let html = '<!DOCTYPE html>\n<html>\n<head>\n<title>Exported HTML</title>\n</head>\n<body>\n';
            
            elements.forEach(element => {
                const rect = element.getBoundingClientRect();
                const canvasRect = canvas.getBoundingClientRect();
                const relativeX = rect.left - canvasRect.left;
                const relativeY = rect.top - canvasRect.top;
                
                html += `<div style="position: absolute; left: ${relativeX}px; top: ${relativeY}px; width: ${element.style.width}; height: ${element.style.height}; ${element.style.cssText}">\n`;
                html += element.innerHTML.replace(/<div class="element-handles">.*?<\/div>/s, '') + '\n';
                html += '</div>\n';
            });
            
            html += '</body>\n</html>';
            
            // Download HTML file
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = editorState.currentProject + '.html';
            a.click();
            URL.revokeObjectURL(url);
            
            errorHandler.logError('INFO', 'HTML exported successfully', { source: 'export' });
        });

        // Canvas Mode Switching
        document.getElementById('preview-mode').addEventListener('click', (e) => {
            const button = e.target;
            const canvas = document.getElementById('editor-canvas');
            
            if (editorState.isPreviewMode) {
                // Exit preview mode
                editorState.isPreviewMode = false;
                button.textContent = 'Preview';
                button.classList.remove('active');
                canvas.querySelectorAll('.dropped-element').forEach(el => {
                    el.style.pointerEvents = 'auto';
                    el.classList.remove('preview-mode');
                });
            } else {
                // Enter preview mode
                editorState.isPreviewMode = true;
                button.textContent = 'Edit';
                button.classList.add('active');
                canvas.querySelectorAll('.dropped-element').forEach(el => {
                    el.style.pointerEvents = 'none';
                    el.classList.add('preview-mode');
                    el.classList.remove('selected');
                });
                editorState.selectedElement = null;
                editorState.hidePropertyPanel();
            }
        });

        document.getElementById('code-view').addEventListener('click', () => {
            const canvas = document.getElementById('editor-canvas');
            const elements = canvas.querySelectorAll('.dropped-element');
            
            let code = '';
            elements.forEach(element => {
                code += `<!-- ${element.id} -->\n`;
                code += element.outerHTML.replace(/<div class="element-handles">.*?<\/div>/s, '') + '\n\n';
            });
            
            const codeWindow = window.open('', '_blank');
            codeWindow.document.write(`
                <html>
                <head><title>Generated Code</title></head>
                <body>
                <h2>Generated HTML Code</h2>
                <pre style="background: #f5f5f5; padding: 20px; border-radius: 4px; overflow: auto;">${code.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</pre>
                </body>
                </html>
            `);
        });

        // Responsive Testing
        document.getElementById('responsive-test').addEventListener('click', (e) => {
            const button = e.target;
            const canvas = document.getElementById('editor-canvas');
            
            if (canvas.classList.contains('responsive-frame')) {
                canvas.classList.remove('responsive-frame', 'mobile', 'tablet');
                button.textContent = 'Responsive';
                button.classList.remove('active');
            } else {
                canvas.classList.add('responsive-frame', 'mobile');
                button.textContent = 'Desktop';
                button.classList.add('active');
            }
        });

        // Zoom Control
        document.getElementById('zoom-level').addEventListener('change', (e) => {
            const zoomLevel = parseInt(e.target.value) / 100;
            const canvas = document.getElementById('editor-canvas');
            canvas.style.transform = `scale(${zoomLevel})`;
            canvas.style.transformOrigin = 'top left';
        });

        // Collapsible Sections
        document.querySelectorAll('.section.collapsible h4').forEach(header => {
            header.addEventListener('click', () => {
                const section = header.parentElement;
                section.classList.toggle('collapsed');
            });
        });

        // Property Panel Event Handlers
        document.getElementById('element-id').addEventListener('input', (e) => {
            if (editorState.selectedElement) {
                editorState.selectedElement.element.id = e.target.value;
            }
        });

        document.getElementById('element-class').addEventListener('input', (e) => {
            if (editorState.selectedElement) {
                editorState.selectedElement.element.className = 'dropped-element ' + e.target.value;
            }
        });

        document.getElementById('apply-css').addEventListener('click', () => {
            if (editorState.selectedElement) {
                const cssInput = document.getElementById('css-input');
                try {
                    editorState.selectedElement.element.style.cssText += '; ' + cssInput.value;
                    editorState.saveState();
                    errorHandler.logError('INFO', 'CSS applied successfully', { source: 'css-editor' });
                } catch (error) {
                    errorHandler.logError('ERROR', 'Invalid CSS syntax', { source: 'css-editor', details: error.message });
                }
            }
        });

        // Error Panel Controls
        document.getElementById('clear-errors').addEventListener('click', () => {
            errorHandler.clearAllErrors();
        });

        document.getElementById('error-search').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            const messages = document.querySelectorAll('.error-message');
            
            messages.forEach(message => {
                const text = message.textContent.toLowerCase();
                message.style.display = text.includes(query) ? 'flex' : 'none';
            });
        });

        document.getElementById('severity-filter').addEventListener('change', (e) => {
            const severity = e.target.value;
            const messages = document.querySelectorAll('.error-message');
            
            messages.forEach(message => {
                if (severity === 'all') {
                    message.style.display = 'flex';
                } else {
                    message.style.display = message.classList.contains(severity) ? 'flex' : 'none';
                }
            });
        });

        // Click outside to deselect
        document.getElementById('editor-canvas').addEventListener('click', (e) => {
            if (e.target.id === 'editor-canvas') {
                editorState.deselectAll();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 'z':
                        e.preventDefault();
                        if (e.shiftKey) {
                            editorState.redo();
                        } else {
                            editorState.undo();
                        }
                        break;
                    case 's':
                        e.preventDefault();
                        document.getElementById('save-btn').click();
                        break;
                    case 'n':
                        e.preventDefault();
                        document.getElementById('new-btn').click();
                        break;
                }
            }
            
            if (e.key === 'Delete' && editorState.selectedElement) {
                editorState.deleteElement(editorState.selectedElement);
            }
            
            if (e.key === 'Escape') {
                editorState.deselectAll();
            }
        });

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            errorHandler.logError('INFO', 'HTML Editor initialized successfully', { source: 'system' });
            
            // Load saved state if available
            const savedState = sessionStorage.getItem('editorState');
            if (savedState) {
                try {
                    const state = JSON.parse(savedState);
                    editorState.loadState(state);
                    errorHandler.logError('INFO', 'Previous session restored', { source: 'system' });
                } catch (error) {
                    errorHandler.logError('WARNING', 'Could not restore previous session', { source: 'system' });
                }
            }
        });

        // Auto-hide status container after 5 seconds of inactivity
        let statusTimeout;
        const statusContainer = document.getElementById('status-container');
        
        function resetStatusTimeout() {
            clearTimeout(statusTimeout);
            statusTimeout = setTimeout(() => {
                if (statusContainer.querySelectorAll('.error-message').length === 0) {
                    statusContainer.classList.add('hidden');
                }
            }, 5000);
        }

        // Reset timeout when new errors are added
        const observer = new MutationObserver(resetStatusTimeout);
        observer.observe(document.getElementById('status-message-list'), { childList: true });
    </script>
</body>
</html>